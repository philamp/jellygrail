#!/bin/bash

# Wait for MariaDB to be ready
until mysqladmin ping -h localhost --silent; do
    echo "Waiting for MariaDB..."
    sleep 2
done

# Check if MariaDB has already been initialized
if [ ! -f /var/lib/mysql/.mariadb_initialized ]; then
    echo "Initializing MariaDB and creating users..."

    # Initialize the database and create the kodi user
    mysql -u root -e "CREATE USER 'kodi'@'%' IDENTIFIED BY 'kodi';"
    mysql -u root -e "GRANT ALL PRIVILEGES ON *.* TO 'kodi'@'%' WITH GRANT OPTION;"
    mysql -u root -e "FLUSH PRIVILEGES;"

    # Create the initialization flag
    touch /var/lib/mysql/.mariadb_initialized
fi
